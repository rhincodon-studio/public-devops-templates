# ============================================================================
# Trivy Security Scan Template
# ============================================================================
# 
# ğŸ“‹ åŠŸèƒ½èªªæ˜ï¼š
#   - ä½¿ç”¨ Trivy æƒæä¾è³´å¥—ä»¶æ¼æ´
#   - æ”¯æ´å®¹å™¨æ˜ åƒæƒæï¼ˆé¸å¡«ï¼‰
#   - æª¢æ¸¬ CRITICAL å’Œ HIGH ç­‰ç´šçš„å®‰å…¨å•é¡Œ
#
# ğŸ”§ ä½¿ç”¨æ–¹å¼ï¼š
#   jobs:
#     security-scan:
#       uses: ./.github/workflows/scan-trivy-tpl.yml
#       with:
#         image-name: "myorg/myimage:latest"  # é¸å¡«
#
# ğŸ“¦ è¼¸å…¥åƒæ•¸ï¼š
#   - image-name: å®¹å™¨æ˜ åƒåç¨±ï¼ˆé¸å¡«ï¼Œè‹¥æä¾›å‰‡åŸ·è¡Œå®¹å™¨æƒæï¼‰
#   - runs_on: Runner é¡å‹ï¼ˆé¸å¡«ï¼Œé è¨­ï¼šubuntu-latestï¼‰
#
# ============================================================================

name: Trivy Dependency Scan (Template)

on:
  workflow_call:
    inputs:
      image-name:
        description: 'Container image name for image scan (optional)'
        required: false
        type: string
        default: ''

      runs_on:
        description: 'Runner type'
        type: string
        required: false
        default: '"ubuntu-latest"'
jobs:
  deps-scan:
    runs-on: ${{ fromJSON(inputs.runs_on) }}
    steps:
      - uses: actions/checkout@v4
      - name: Scan dependencies
        uses: aquasecurity/trivy-action@v0
        with:
          scan-type: fs
          severity: CRITICAL,HIGH

  image-scan:
    if: inputs.image-name != ''
    runs-on: ${{ fromJSON(inputs.runs_on) }}
    steps:
      - name: Scan image
        uses: aquasecurity/trivy-action@v0
        with:
          scan-type: image
          image-ref: ${{ inputs.image-name }}